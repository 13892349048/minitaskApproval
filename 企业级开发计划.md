# 多层级项目管理系统企业级开发计划

## 🎯 项目概览

### 项目信息
- **项目名称**：TaskFlow - 多层级项目管理系统
- **项目类型**：企业级Web应用系统
- **技术架构**：DDD + 六边形架构 + 事件驱动
- **开发周期**：12周（3个月）
- **团队规模**：2-4人（可调整）

### 项目目标
- **业务目标**：解决企业多层级项目管理和任务协作问题
- **技术目标**：实践DDD和现代架构设计模式
- **质量目标**：企业级代码质量和生产就绪标准

## 📅 开发阶段规划

### 阶段1：基础设施和核心框架（Week 1-2）

#### Week 1: 项目初始化
**目标**：搭建项目基础框架和开发环境

**具体任务**：
- [ ] 项目目录结构搭建
- [ ] Go模块初始化和依赖管理
- [ ] Docker开发环境配置
- [ ] 数据库设计和初始化脚本
- [ ] 基础配置和日志系统
- [ ] CI/CD流水线搭建

**交付物**：
- 完整的项目骨架
- 可运行的开发环境
- 基础的CI/CD流水线

#### Week 2: 核心基础设施
**目标**：实现核心基础设施组件

**具体任务**：
- [ ] 数据库连接和事务管理
- [ ] JWT认证和授权中间件
- [ ] RBAC+ABAC权限系统框架
- [ ] 内存事件总线实现
- [ ] 统一错误处理和响应格式
- [ ] API文档框架（Swagger）

**交付物**：
- 认证授权系统
- 权限管理框架
- 事件驱动基础设施

### 阶段2：领域模型和核心业务（Week 3-5）

#### Week 3: 用户和权限领域
**目标**：实现用户管理和权限控制

**具体任务**：
- [ ] User聚合根实现
- [ ] 角色和权限模型
- [ ] ABAC权限评估引擎
- [ ] 用户认证API
- [ ] 权限管理API
- [ ] 单元测试覆盖

**交付物**：
- 用户管理完整功能
- 权限系统核心实现
- 认证授权API

#### Week 4: 项目管理领域
**目标**：实现项目层级管理

**具体任务**：
- [ ] Project聚合根实现
- [ ] 项目层级关系管理
- [ ] 项目成员管理
- [ ] 项目CRUD API
- [ ] 项目权限集成
- [ ] 集成测试

**交付物**：
- 项目管理完整功能
- 项目层级管理
- 项目管理API

#### Week 5: 任务管理领域
**目标**：实现任务核心功能

**具体任务**：
- [ ] Task聚合根实现
- [ ] 任务状态机实现
- [ ] 任务参与人员管理
- [ ] 任务CRUD API
- [ ] 任务分配和审批API
- [ ] 任务权限集成

**交付物**：
- 任务管理核心功能
- 任务状态流转
- 任务管理API

### 阶段3：高级功能和业务流程（Week 6-8）

#### Week 6: 任务执行和协作
**目标**：实现任务执行和多人协作

**具体任务**：
- [ ] TaskExecution执行记录
- [ ] 参与人员工作提交
- [ ] 负责人审批功能
- [ ] 任务完成确认流程
- [ ] 执行相关API
- [ ] 工作流测试

**交付物**：
- 任务执行完整流程
- 多人协作机制
- 执行管理API

#### Week 7: 重复任务和延期管理
**目标**：实现重复任务和延期申请

**具体任务**：
- [ ] 重复任务规则引擎
- [ ] 定时任务调度系统
- [ ] 延期申请和审批
- [ ] 重复任务API
- [ ] 延期管理API
- [ ] 调度系统测试

**交付物**：
- 重复任务工作流
- 延期申请系统
- 调度管理功能

#### Week 8: 文件管理和搜索
**目标**：实现文件上传和搜索功能

**具体任务**：
- [ ] 大文件分片上传
- [ ] 断点续传功能
- [ ] 文件关联管理
- [ ] MySQL全文搜索
- [ ] 文件管理API
- [ ] 搜索API

**交付物**：
- 文件管理系统
- 搜索功能
- 文件和搜索API

### 阶段4：统计分析和系统完善（Week 9-10）

#### Week 9: 统计分析系统
**目标**：实现数据统计和分析

**具体任务**：
- [ ] 任务统计分析服务
- [ ] 用户工作负载分析
- [ ] 项目进度报表
- [ ] 数据可视化接口
- [ ] 缓存优化
- [ ] 统计API

**交付物**：
- 统计分析系统
- 数据报表功能
- 分析API

#### Week 10: 系统优化和完善
**目标**：性能优化和功能完善

**具体任务**：
- [ ] 数据库查询优化
- [ ] 缓存策略实施
- [ ] API性能优化
- [ ] 错误处理完善
- [ ] 日志系统优化
- [ ] 安全加固

**交付物**：
- 性能优化版本
- 完善的错误处理
- 安全加固系统

### 阶段5：测试和部署准备（Week 11-12）

#### Week 11: 全面测试
**目标**：完整的测试覆盖

**具体任务**：
- [ ] 单元测试完善（80%+覆盖率）
- [ ] 集成测试实施
- [ ] E2E测试场景
- [ ] 性能压力测试
- [ ] 安全测试
- [ ] 用户验收测试

**交付物**：
- 完整测试套件
- 测试报告
- 性能基准

#### Week 12: 生产部署
**目标**：生产环境部署上线

**具体任务**：
- [ ] 生产环境配置
- [ ] 数据库迁移脚本
- [ ] 监控系统部署
- [ ] 日志收集配置
- [ ] 备份恢复方案
- [ ] 上线发布

**交付物**：
- 生产就绪系统
- 部署文档
- 运维手册

## 🏗️ 详细技术实施方案

### 1. 项目目录结构

```
taskflow/
├── cmd/                           # 应用程序入口
│   ├── api/                       # Web API服务
│   │   └── main.go
│   ├── worker/                    # 后台任务处理
│   │   └── main.go
│   └── migrate/                   # 数据库迁移工具
│       └── main.go
│
├── internal/                      # 私有应用代码
│   ├── domain/                    # 领域层
│   │   ├── user/                  # 用户聚合
│   │   │   ├── aggregate.go       # 用户聚合根
│   │   │   ├── repository.go      # 仓储接口
│   │   │   ├── service.go         # 领域服务
│   │   │   ├── events.go          # 领域事件
│   │   │   └── specifications.go  # 业务规格
│   │   ├── project/               # 项目聚合
│   │   │   ├── aggregate.go
│   │   │   ├── repository.go
│   │   │   ├── service.go
│   │   │   ├── events.go
│   │   │   └── value_objects.go
│   │   ├── task/                  # 任务聚合
│   │   │   ├── aggregate.go
│   │   │   ├── repository.go
│   │   │   ├── service.go
│   │   │   ├── events.go
│   │   │   ├── state_machine.go
│   │   │   └── execution.go
│   │   └── shared/                # 共享领域概念
│   │       ├── events.go
│   │       ├── value_objects.go
│   │       └── specifications.go
│   │
│   ├── application/               # 应用服务层
│   │   ├── user/                  # 用户应用服务
│   │   │   ├── service.go
│   │   │   ├── commands.go
│   │   │   ├── queries.go
│   │   │   └── dto.go
│   │   ├── project/               # 项目应用服务
│   │   │   ├── service.go
│   │   │   ├── commands.go
│   │   │   ├── queries.go
│   │   │   └── dto.go
│   │   ├── task/                  # 任务应用服务
│   │   │   ├── service.go
│   │   │   ├── commands.go
│   │   │   ├── queries.go
│   │   │   └── dto.go
│   │   └── shared/                # 共享应用服务
│   │       ├── events/            # 事件处理器
│   │       ├── permissions/       # 权限服务
│   │       └── notifications/     # 通知服务
│   │
│   ├── infrastructure/            # 基础设施层
│   │   ├── persistence/           # 持久化
│   │   │   ├── mysql/
│   │   │   │   ├── user_repository.go
│   │   │   │   ├── project_repository.go
│   │   │   │   ├── task_repository.go
│   │   │   │   ├── models.go
│   │   │   │   └── migrations/
│   │   │   └── redis/
│   │   │       ├── cache.go
│   │   │       └── session.go
│   │   ├── messaging/             # 消息传递
│   │   │   ├── memory/
│   │   │   │   └── event_bus.go
│   │   │   └── kafka/             # 预留
│   │   │       └── publisher.go
│   │   ├── external/              # 外部服务
│   │   │   ├── email/
│   │   │   │   └── smtp_service.go
│   │   │   └── storage/
│   │   │       └── file_service.go
│   │   ├── config/                # 配置
│   │   │   ├── database.go
│   │   │   ├── redis.go
│   │   │   └── app.go
│   │   └── scheduler/             # 任务调度
│   │       └── cron_service.go
│   │
│   └── interfaces/                # 接口适配器层
│       ├── http/                  # HTTP适配器
│       │   ├── controllers/
│       │   │   ├── auth_controller.go
│       │   │   ├── user_controller.go
│       │   │   ├── project_controller.go
│       │   │   ├── task_controller.go
│       │   │   └── file_controller.go
│       │   ├── middleware/
│       │   │   ├── auth.go
│       │   │   ├── cors.go
│       │   │   ├── logging.go
│       │   │   └── recovery.go
│       │   ├── requests/
│       │   │   ├── auth_request.go
│       │   │   ├── user_request.go
│       │   │   ├── project_request.go
│       │   │   └── task_request.go
│       │   ├── responses/
│       │   │   ├── common.go
│       │   │   ├── user_response.go
│       │   │   ├── project_response.go
│       │   │   └── task_response.go
│       │   └── router.go
│       └── cli/                   # CLI适配器
│           ├── commands/
│           └── root.go
│
├── pkg/                           # 公共库
│   ├── logger/                    # 日志
│   │   ├── logger.go
│   │   └── zap.go
│   ├── validator/                 # 验证
│   │   └── validator.go
│   ├── errors/                    # 错误处理
│   │   ├── domain_errors.go
│   │   ├── app_errors.go
│   │   └── http_errors.go
│   ├── utils/                     # 工具
│   │   ├── crypto.go
│   │   ├── time.go
│   │   └── uuid.go
│   └── constants/                 # 常量
│       └── constants.go
│
├── api/                           # API定义
│   ├── openapi/                   # OpenAPI规范
│   │   └── taskflow.yaml
│   └── proto/                     # gRPC定义（预留）
│       └── taskflow.proto
│
├── configs/                       # 配置文件
│   ├── config.yaml
│   ├── config.dev.yaml
│   ├── config.test.yaml
│   ├── config.prod.yaml
│   └── docker-compose.yml
│
├── scripts/                       # 脚本
│   ├── build.sh
│   ├── test.sh
│   ├── deploy.sh
│   ├── migrate.sh
│   └── docker/
│       ├── Dockerfile
│       ├── Dockerfile.dev
│       └── docker-entrypoint.sh
│
├── test/                          # 测试
│   ├── unit/                      # 单元测试
│   │   ├── domain/
│   │   ├── application/
│   │   └── infrastructure/
│   ├── integration/               # 集成测试
│   │   ├── api/
│   │   └── database/
│   ├── e2e/                      # 端到端测试
│   │   ├── scenarios/
│   │   └── fixtures/
│   └── testdata/                 # 测试数据
│       ├── fixtures/
│       └── mocks/
│
├── docs/                          # 文档
│   ├── api.md
│   ├── architecture.md
│   ├── deployment.md
│   └── development.md
│
├── deployments/                   # 部署配置
│   ├── kubernetes/
│   │   ├── namespace.yaml
│   │   ├── deployment.yaml
│   │   ├── service.yaml
│   │   ├── ingress.yaml
│   │   └── configmap.yaml
│   ├── docker/
│   │   └── docker-compose.prod.yml
│   └── terraform/                 # 基础设施即代码
│       ├── main.tf
│       └── variables.tf
│
├── monitoring/                    # 监控配置
│   ├── prometheus/
│   │   └── rules.yml
│   ├── grafana/
│   │   └── dashboards/
│   └── alertmanager/
│       └── config.yml
│
├── .github/                       # GitHub工作流
│   └── workflows/
│       ├── ci.yml
│       ├── cd.yml
│       └── security.yml
│
├── .gitignore
├── .golangci.yml                 # Go lint配置
├── go.mod
├── go.sum
├── Makefile
├── README.md
└── CHANGELOG.md
```

### 2. 核心模型设计

#### 用户聚合根
```go
// internal/domain/user/aggregate.go
package user

import (
    "time"
    "github.com/taskflow/internal/domain/shared"
)

// User 用户聚合根
type User struct {
    id          UserID
    email       Email
    name        string
    avatar      string
    status      UserStatus
    roles       []Role
    permissions []Permission
    profile     UserProfile
    createdAt   time.Time
    updatedAt   time.Time
    
    // 组织关系
    departmentID DepartmentID
    managerID    *UserID
    subordinates []UserID
    
    // 项目关系
    ownedProjects   []ProjectID
    managedProjects []ProjectID
    memberProjects  []ProjectID
    
    // 领域事件
    events []shared.DomainEvent
}

// 用户业务方法
func (u *User) UpdateProfile(name, avatar string) error
func (u *User) AssignRole(role Role) error
func (u *User) RemoveRole(roleID RoleID) error
func (u *User) GrantPermission(permission Permission) error
func (u *User) RevokePermission(permissionID PermissionID) error
func (u *User) CanPerformAction(resource, action string) bool
func (u *User) AddSubordinate(subordinateID UserID) error
func (u *User) RemoveSubordinate(subordinateID UserID) error

// 值对象定义
type UserID string
type Email string
type UserStatus int
type UserProfile struct {
    Phone       string
    Department  string
    Position    string
    JoinDate    time.Time
}

const (
    UserStatusActive UserStatus = iota
    UserStatusInactive
    UserStatusSuspended
)
```

#### 项目聚合根
```go
// internal/domain/project/aggregate.go
package project

import (
    "time"
    "github.com/taskflow/internal/domain/shared"
    "github.com/taskflow/internal/domain/user"
)

// Project 项目聚合根
type Project struct {
    id          ProjectID
    name        string
    description string
    projectType ProjectType
    status      ProjectStatus
    
    // 层级关系
    parentID *ProjectID
    children []ProjectID
    
    // 人员管理
    ownerID   user.UserID
    managerID *user.UserID
    members   []ProjectMember
    
    // 时间管理
    startDate   time.Time
    endDate     *time.Time
    createdAt   time.Time
    updatedAt   time.Time
    
    // 统计信息
    taskCount     int
    completedTasks int
    
    events []shared.DomainEvent
}

// 项目业务方法
func (p *Project) AssignManager(managerID user.UserID) error
func (p *Project) AddMember(userID user.UserID, role ProjectRole) error
func (p *Project) RemoveMember(userID user.UserID) error
func (p *Project) UpdateMemberRole(userID user.UserID, role ProjectRole) error
func (p *Project) CreateSubProject(name, description string) (*Project, error)
func (p *Project) CanUserAccess(userID user.UserID) bool
func (p *Project) GetMemberRole(userID user.UserID) *ProjectRole
func (p *Project) UpdateProgress() error

// 项目成员值对象
type ProjectMember struct {
    UserID   user.UserID
    Role     ProjectRole
    JoinedAt time.Time
    AddedBy  user.UserID
}

type ProjectRole int
const (
    ProjectRoleManager ProjectRole = iota
    ProjectRoleMember
)
```

#### 任务聚合根
```go
// internal/domain/task/aggregate.go
package task

import (
    "time"
    "github.com/taskflow/internal/domain/shared"
    "github.com/taskflow/internal/domain/user"
    "github.com/taskflow/internal/domain/project"
)

// Task 任务聚合根
type Task struct {
    id          TaskID
    title       string
    description string
    taskType    TaskType
    priority    Priority
    status      TaskStatus
    
    // 关联关系
    projectID     project.ProjectID
    creatorID     user.UserID
    responsibleID user.UserID
    participants  []user.UserID
    
    // 时间管理
    createdAt      time.Time
    updatedAt      time.Time
    startDate      time.Time
    dueDate        time.Time
    completedAt    *time.Time
    estimatedHours int
    
    // 重复任务
    recurrenceRule *RecurrenceRule
    workflowID     *WorkflowID
    
    // 执行记录
    executions []TaskExecution
    
    // 审批记录
    approvals []ApprovalRecord
    
    // 延期申请
    extensions []ExtensionRequest
    
    // 文件附件
    attachments []AttachmentID
    
    // 状态机
    stateMachine TaskStateMachine
    
    events []shared.DomainEvent
}

// 任务业务方法
func (t *Task) Submit(submitter *user.User) error
func (t *Task) Approve(approver *user.User, comment string) error
func (t *Task) Reject(approver *user.User, reason string) error
func (t *Task) Assign(assigner *user.User, responsible *user.User) error
func (t *Task) AddParticipant(adder *user.User, participant *user.User) error
func (t *Task) RemoveParticipant(remover *user.User, participantID user.UserID) error
func (t *Task) StartExecution(executor *user.User) error
func (t *Task) SubmitWork(participant *user.User, workResult string) error
func (t *Task) ReviewWork(reviewer *user.User, participantID user.UserID, approved bool, comment string) error
func (t *Task) SubmitCompletion(responsible *user.User, result string) error
func (t *Task) ConfirmCompletion(confirmer *user.User, approved bool, comment string) error
func (t *Task) RequestExtension(requester *user.User, newDueDate time.Time, reason string) error
func (t *Task) ReviewExtension(reviewer *user.User, requestID ExtensionRequestID, approved bool, comment string) error
func (t *Task) SetRecurrence(rule RecurrenceRule) error
func (t *Task) PrepareNextExecution() error

// 任务执行记录
type TaskExecution struct {
    ID            ExecutionID
    TaskID        TaskID
    ExecutionDate time.Time
    Status        ExecutionStatus
    StartedAt     *time.Time
    SubmittedAt   *time.Time
    CompletedAt   *time.Time
    Result        string
    
    // 参与人员完成记录
    ParticipantCompletions []ParticipantCompletion
}

// 参与人员完成记录
type ParticipantCompletion struct {
    ParticipantID user.UserID
    WorkResult    string
    Status        CompletionStatus
    SubmittedAt   time.Time
    ReviewedAt    *time.Time
    ReviewerID    *user.UserID
    ReviewComment string
}
```

### 3. 应用服务设计

#### 任务应用服务
```go
// internal/application/task/service.go
package task

import (
    "context"
    "github.com/taskflow/internal/domain/task"
    "github.com/taskflow/internal/domain/user"
    "github.com/taskflow/internal/domain/project"
    "github.com/taskflow/internal/application/shared/permissions"
)

type TaskAppService struct {
    taskRepo         task.Repository
    userRepo         user.Repository
    projectRepo      project.Repository
    permissionSvc    permissions.Service
    eventPublisher   shared.EventPublisher
    stateMachine     task.StateMachine
    transactionMgr   shared.TransactionManager
}

// 创建任务
func (s *TaskAppService) CreateTask(ctx context.Context, cmd *CreateTaskCommand) (*TaskDTO, error) {
    return s.transactionMgr.WithTransaction(ctx, func(ctx context.Context) (*TaskDTO, error) {
        // 1. 验证权限
        canCreate, err := s.permissionSvc.CanUserPerformAction(
            ctx, cmd.CreatorID, "task", "create", map[string]interface{}{
                "project_id": cmd.ProjectID,
            })
        if err != nil {
            return nil, err
        }
        if !canCreate {
            return nil, shared.NewPermissionDeniedError("insufficient permission to create task")
        }
        
        // 2. 获取相关聚合根
        creator, err := s.userRepo.FindByID(ctx, cmd.CreatorID)
        if err != nil {
            return nil, err
        }
        
        project, err := s.projectRepo.FindByID(ctx, cmd.ProjectID)
        if err != nil {
            return nil, err
        }
        
        // 3. 创建任务
        task := task.NewTask(
            cmd.Title,
            cmd.Description,
            cmd.TaskType,
            cmd.Priority,
            cmd.ProjectID,
            creator.ID(),
        )
        
        // 4. 设置负责人
        if cmd.ResponsibleID != "" {
            responsible, err := s.userRepo.FindByID(ctx, cmd.ResponsibleID)
            if err != nil {
                return nil, err
            }
            
            if err := task.SetResponsible(responsible.ID()); err != nil {
                return nil, err
            }
        } else {
            // 如果是员工申请任务，自动设为负责人
            if err := task.SetResponsible(creator.ID()); err != nil {
                return nil, err
            }
        }
        
        // 5. 保存任务
        if err := s.taskRepo.Save(ctx, task); err != nil {
            return nil, err
        }
        
        // 6. 发布事件
        for _, event := range task.Events() {
            if err := s.eventPublisher.Publish(ctx, event); err != nil {
                // 记录日志，但不影响主流程
                // TODO: 添加日志
            }
        }
        
        return s.taskToDTO(task), nil
    })
}

// 提交任务审批
func (s *TaskAppService) SubmitTask(ctx context.Context, cmd *SubmitTaskCommand) error {
    return s.transactionMgr.WithTransaction(ctx, func(ctx context.Context) error {
        // 1. 获取任务和提交人
        task, err := s.taskRepo.FindByID(ctx, cmd.TaskID)
        if err != nil {
            return err
        }
        
        submitter, err := s.userRepo.FindByID(ctx, cmd.SubmitterID)
        if err != nil {
            return err
        }
        
        // 2. 执行提交
        if err := task.Submit(submitter); err != nil {
            return err
        }
        
        // 3. 保存更改
        if err := s.taskRepo.Save(ctx, task); err != nil {
            return err
        }
        
        // 4. 发布事件
        for _, event := range task.Events() {
            s.eventPublisher.Publish(ctx, event)
        }
        
        return nil
    })
}

// 其他业务方法...
func (s *TaskAppService) ApproveTask(ctx context.Context, cmd *ApproveTaskCommand) error
func (s *TaskAppService) AssignTask(ctx context.Context, cmd *AssignTaskCommand) error
func (s *TaskAppService) AddParticipant(ctx context.Context, cmd *AddParticipantCommand) error
func (s *TaskAppService) SubmitWork(ctx context.Context, cmd *SubmitWorkCommand) error
func (s *TaskAppService) ReviewWork(ctx context.Context, cmd *ReviewWorkCommand) error
func (s *TaskAppService) RequestExtension(ctx context.Context, cmd *RequestExtensionCommand) error
func (s *TaskAppService) GetTaskDetails(ctx context.Context, query *GetTaskQuery) (*TaskDetailDTO, error)
func (s *TaskAppService) ListTasks(ctx context.Context, query *ListTasksQuery) (*TaskListDTO, error)
```

### 4. API接口设计

#### 任务管理API
```go
// internal/interfaces/http/controllers/task_controller.go
package controllers

import (
    "net/http"
    "github.com/gin-gonic/gin"
    "github.com/taskflow/internal/application/task"
    "github.com/taskflow/internal/interfaces/http/requests"
    "github.com/taskflow/internal/interfaces/http/responses"
)

type TaskController struct {
    taskAppService *task.TaskAppService
}

// @Summary 创建任务
// @Description 创建新的任务
// @Tags 任务管理
// @Accept json
// @Produce json
// @Param request body requests.CreateTaskRequest true "创建任务请求"
// @Success 201 {object} responses.TaskResponse
// @Failure 400 {object} responses.ErrorResponse
// @Failure 401 {object} responses.ErrorResponse
// @Failure 403 {object} responses.ErrorResponse
// @Failure 500 {object} responses.ErrorResponse
// @Security Bearer
// @Router /api/v1/tasks [post]
func (c *TaskController) CreateTask(ctx *gin.Context) {
    var req requests.CreateTaskRequest
    if err := ctx.ShouldBindJSON(&req); err != nil {
        responses.BadRequest(ctx, "请求参数错误", err)
        return
    }
    
    // 获取当前用户ID
    userID := ctx.GetString("user_id")
    
    // 构建命令
    cmd := &task.CreateTaskCommand{
        Title:         req.Title,
        Description:   req.Description,
        TaskType:      req.TaskType,
        Priority:      req.Priority,
        ProjectID:     req.ProjectID,
        ResponsibleID: req.ResponsibleID,
        CreatorID:     userID,
        DueDate:       req.DueDate,
        EstimatedHours: req.EstimatedHours,
    }
    
    // 执行业务逻辑
    result, err := c.taskAppService.CreateTask(ctx.Request.Context(), cmd)
    if err != nil {
        responses.HandleError(ctx, err)
        return
    }
    
    responses.Created(ctx, "任务创建成功", result)
}

// @Summary 获取任务列表
// @Description 获取任务列表，支持分页和筛选
// @Tags 任务管理
// @Accept json
// @Produce json
// @Param page query int false "页码" default(1)
// @Param page_size query int false "每页大小" default(20)
// @Param project_id query string false "项目ID"
// @Param status query string false "任务状态"
// @Param responsible_id query string false "负责人ID"
// @Param priority query string false "优先级"
// @Param keyword query string false "搜索关键词"
// @Success 200 {object} responses.TaskListResponse
// @Failure 400 {object} responses.ErrorResponse
// @Failure 401 {object} responses.ErrorResponse
// @Failure 500 {object} responses.ErrorResponse
// @Security Bearer
// @Router /api/v1/tasks [get]
func (c *TaskController) ListTasks(ctx *gin.Context) {
    // 解析查询参数
    query := &task.ListTasksQuery{
        Page:         ctx.DefaultQuery("page", "1"),
        PageSize:     ctx.DefaultQuery("page_size", "20"),
        ProjectID:    ctx.Query("project_id"),
        Status:       ctx.Query("status"),
        ResponsibleID: ctx.Query("responsible_id"),
        Priority:     ctx.Query("priority"),
        Keyword:      ctx.Query("keyword"),
        UserID:       ctx.GetString("user_id"), // 当前用户ID，用于权限过滤
    }
    
    // 执行查询
    result, err := c.taskAppService.ListTasks(ctx.Request.Context(), query)
    if err != nil {
        responses.HandleError(ctx, err)
        return
    }
    
    responses.Success(ctx, "获取任务列表成功", result)
}

// 其他API方法...
func (c *TaskController) GetTask(ctx *gin.Context)
func (c *TaskController) UpdateTask(ctx *gin.Context)
func (c *TaskController) DeleteTask(ctx *gin.Context)
func (c *TaskController) SubmitTask(ctx *gin.Context)
func (c *TaskController) ApproveTask(ctx *gin.Context)
func (c *TaskController) RejectTask(ctx *gin.Context)
func (c *TaskController) AssignTask(ctx *gin.Context)
func (c *TaskController) AddParticipant(ctx *gin.Context)
func (c *TaskController) RemoveParticipant(ctx *gin.Context)
func (c *TaskController) SubmitWork(ctx *gin.Context)
func (c *TaskController) ReviewWork(ctx *gin.Context)
func (c *TaskController) SubmitCompletion(ctx *gin.Context)
func (c *TaskController) ConfirmCompletion(ctx *gin.Context)
func (c *TaskController) RequestExtension(ctx *gin.Context)
```

### 5. 数据库迁移脚本

#### 初始化脚本
```sql
-- scripts/migrations/001_initial_schema.sql

-- 用户表
CREATE TABLE users (
    id VARCHAR(36) PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    avatar VARCHAR(500),
    status ENUM('active', 'inactive', 'suspended') DEFAULT 'active',
    department_id VARCHAR(36),
    manager_id VARCHAR(36),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_email (email),
    INDEX idx_status (status),
    INDEX idx_department (department_id),
    INDEX idx_manager (manager_id)
);

-- 角色表
CREATE TABLE roles (
    id VARCHAR(36) PRIMARY KEY,
    name VARCHAR(50) UNIQUE NOT NULL,
    display_name VARCHAR(100) NOT NULL,
    description TEXT,
    is_system BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 用户角色关联表
CREATE TABLE user_roles (
    user_id VARCHAR(36),
    role_id VARCHAR(36),
    assigned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    assigned_by VARCHAR(36),
    PRIMARY KEY (user_id, role_id),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    FOREIGN KEY (assigned_by) REFERENCES users(id)
);

-- 权限表
CREATE TABLE permissions (
    id VARCHAR(36) PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    resource VARCHAR(50) NOT NULL,
    action VARCHAR(50) NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_resource_action (resource, action)
);

-- 角色权限关联表
CREATE TABLE role_permissions (
    role_id VARCHAR(36),
    permission_id VARCHAR(36),
    PRIMARY KEY (role_id, permission_id),
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE
);

-- ABAC权限策略表
CREATE TABLE permission_policies (
    id VARCHAR(36) PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    resource_type VARCHAR(50) NOT NULL,
    action VARCHAR(50) NOT NULL,
    effect ENUM('allow', 'deny') NOT NULL,
    conditions JSON NOT NULL,
    priority INT DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_resource_action (resource_type, action),
    INDEX idx_priority (priority),
    INDEX idx_active (is_active)
);

-- 项目表
CREATE TABLE projects (
    id VARCHAR(36) PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    project_type ENUM('master', 'sub', 'temporary') NOT NULL,
    parent_project_id VARCHAR(36) NULL,
    owner_id VARCHAR(36) NOT NULL,
    manager_id VARCHAR(36) NULL,
    status ENUM('draft', 'active', 'paused', 'completed', 'cancelled') DEFAULT 'draft',
    start_date DATE,
    end_date DATE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (parent_project_id) REFERENCES projects(id),
    FOREIGN KEY (owner_id) REFERENCES users(id),
    FOREIGN KEY (manager_id) REFERENCES users(id),
    
    INDEX idx_parent_project (parent_project_id),
    INDEX idx_owner (owner_id),
    INDEX idx_manager (manager_id),
    INDEX idx_status (status),
    INDEX idx_type_status (project_type, status)
);

-- 项目成员表
CREATE TABLE project_members (
    id VARCHAR(36) PRIMARY KEY,
    project_id VARCHAR(36) NOT NULL,
    user_id VARCHAR(36) NOT NULL,
    role ENUM('manager', 'member') NOT NULL,
    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    added_by VARCHAR(36),
    
    UNIQUE KEY uk_project_user (project_id, user_id),
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (added_by) REFERENCES users(id),
    
    INDEX idx_project (project_id),
    INDEX idx_user (user_id),
    INDEX idx_role (role)
);

-- 任务表
CREATE TABLE tasks (
    id VARCHAR(36) PRIMARY KEY,
    title VARCHAR(300) NOT NULL,
    description TEXT,
    task_type ENUM('single_execution', 'recurring') NOT NULL,
    priority ENUM('low', 'normal', 'high', 'urgent') DEFAULT 'normal',
    project_id VARCHAR(36) NOT NULL,
    creator_id VARCHAR(36) NOT NULL,
    responsible_id VARCHAR(36) NOT NULL,
    status ENUM('draft', 'pending_approval', 'approved', 'in_progress', 'pending_final_review', 'completed', 'rejected', 'cancelled', 'paused') DEFAULT 'draft',
    
    -- 时间管理
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    start_date TIMESTAMP NULL,
    due_date TIMESTAMP NULL,
    completed_at TIMESTAMP NULL,
    estimated_hours INT DEFAULT 0,
    
    -- 重复任务相关
    workflow_id VARCHAR(36) NULL,
    
    FOREIGN KEY (project_id) REFERENCES projects(id),
    FOREIGN KEY (creator_id) REFERENCES users(id),
    FOREIGN KEY (responsible_id) REFERENCES users(id),
    
    INDEX idx_project_status (project_id, status),
    INDEX idx_responsible_status (responsible_id, status),
    INDEX idx_creator (creator_id),
    INDEX idx_due_date (due_date),
    INDEX idx_status (status),
    INDEX idx_task_type (task_type),
    INDEX idx_priority (priority),
    
    -- 全文搜索索引
    FULLTEXT INDEX ft_title_description (title, description)
);

-- 其他表结构... (参考前面的数据库设计)
```

## 📋 开发里程碑和交付标准

### 里程碑1：基础框架（Week 1-2）
**交付标准**：
- [ ] 项目可以启动并响应HTTP请求
- [ ] 数据库连接和基础CRUD操作
- [ ] JWT认证中间件工作正常
- [ ] 基础API文档可访问
- [ ] Docker开发环境可用
- [ ] CI/CD流水线可以构建和测试

### 里程碑2：用户和项目管理（Week 3-4）
**交付标准**：
- [ ] 用户注册、登录、权限管理
- [ ] 项目CRUD和层级管理
- [ ] 项目成员管理
- [ ] 权限系统基础功能
- [ ] 单元测试覆盖率>70%
- [ ] API文档完整

### 里程碑3：任务核心功能（Week 5-6）
**交付标准**：
- [ ] 任务CRUD和状态流转
- [ ] 任务分配和审批
- [ ] 多人协作功能
- [ ] 权限控制集成
- [ ] 集成测试通过
- [ ] 性能基准测试

### 里程碑4：高级功能（Week 7-8）
**交付标准**：
- [ ] 重复任务和调度
- [ ] 延期申请和审批
- [ ] 文件上传和管理
- [ ] 搜索功能
- [ ] 事件驱动机制
- [ ] E2E测试场景

### 里程碑5：生产就绪（Week 9-12）
**交付标准**：
- [ ] 统计分析和报表
- [ ] 性能优化完成
- [ ] 安全测试通过
- [ ] 监控和日志系统
- [ ] 部署文档完整
- [ ] 生产环境验证

## 🔍 质量保证标准

### 代码质量
- **测试覆盖率**：单元测试>80%，集成测试>60%
- **代码审查**：所有代码必须经过Code Review
- **静态分析**：通过golangci-lint检查
- **性能基准**：API响应时间<200ms（95%分位）

### 安全标准
- **认证授权**：JWT token + RBAC/ABAC权限
- **数据加密**：敏感数据加密存储
- **SQL注入防护**：使用参数化查询
- **XSS防护**：输入验证和输出编码

### 可用性标准
- **系统可用性**：99.9%（月度）
- **故障恢复**：RTO<30分钟，RPO<5分钟
- **监控告警**：关键指标监控和告警
- **文档完整**：API文档、部署文档、运维手册

这个开发计划是否符合你的预期？有什么需要调整或补充的地方吗？
