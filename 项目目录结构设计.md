# ä»»åŠ¡å®¡æ‰¹æµé¡¹ç›®ç›®å½•ç»“æ„è®¾è®¡

## ğŸ“ å®Œæ•´ç›®å½•ç»“æ„

```
task-approval-system/
â”œâ”€â”€ cmd/                           # åº”ç”¨ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ api/                       # Web API æœåŠ¡
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â”œâ”€â”€ worker/                    # äº‹ä»¶å¤„ç†å·¥ä½œè€…
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â””â”€â”€ cli/                       # å‘½ä»¤è¡Œå·¥å…·
â”‚       â””â”€â”€ main.go
â”‚
â”œâ”€â”€ internal/                      # ç§æœ‰åº”ç”¨ä»£ç 
â”‚   â”œâ”€â”€ domain/                    # é¢†åŸŸå±‚
â”‚   â”‚   â”œâ”€â”€ aggregate/             # èšåˆæ ¹
â”‚   â”‚   â”‚   â”œâ”€â”€ task.go
â”‚   â”‚   â”‚   â””â”€â”€ user.go
â”‚   â”‚   â”œâ”€â”€ entity/                # å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ approval.go
â”‚   â”‚   â”‚   â””â”€â”€ notification.go
â”‚   â”‚   â”œâ”€â”€ valueobject/           # å€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ task_status.go
â”‚   â”‚   â”‚   â”œâ”€â”€ priority.go
â”‚   â”‚   â”‚   â”œâ”€â”€ task_type.go
â”‚   â”‚   â”‚   â””â”€â”€ approval_action.go
â”‚   â”‚   â”œâ”€â”€ service/               # é¢†åŸŸæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ task_assignment_service.go
â”‚   â”‚   â”‚   â”œâ”€â”€ approval_rule_service.go
â”‚   â”‚   â”‚   â””â”€â”€ state_machine_service.go
â”‚   â”‚   â”œâ”€â”€ event/                 # é¢†åŸŸäº‹ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ task_events.go
â”‚   â”‚   â”‚   â”œâ”€â”€ user_events.go
â”‚   â”‚   â”‚   â””â”€â”€ event_base.go
â”‚   â”‚   â”œâ”€â”€ repository/            # ä»“å‚¨æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ task_repository.go
â”‚   â”‚   â”‚   â”œâ”€â”€ user_repository.go
â”‚   â”‚   â”‚   â””â”€â”€ audit_log_repository.go
â”‚   â”‚   â””â”€â”€ specification/         # ä¸šåŠ¡è§„æ ¼
â”‚   â”‚       â”œâ”€â”€ task_specification.go
â”‚   â”‚       â””â”€â”€ approval_specification.go
â”‚   â”‚
â”‚   â”œâ”€â”€ application/               # åº”ç”¨æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ service/               # åº”ç”¨æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ task_app_service.go
â”‚   â”‚   â”‚   â”œâ”€â”€ user_app_service.go
â”‚   â”‚   â”‚   â””â”€â”€ notification_app_service.go
â”‚   â”‚   â”œâ”€â”€ command/               # å‘½ä»¤å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ task_commands.go
â”‚   â”‚   â”‚   â””â”€â”€ user_commands.go
â”‚   â”‚   â”œâ”€â”€ query/                 # æŸ¥è¯¢å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ task_queries.go
â”‚   â”‚   â”‚   â””â”€â”€ user_queries.go
â”‚   â”‚   â”œâ”€â”€ dto/                   # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ task_dto.go
â”‚   â”‚   â”‚   â””â”€â”€ user_dto.go
â”‚   â”‚   â””â”€â”€ handler/               # äº‹ä»¶å¤„ç†å™¨
â”‚   â”‚       â”œâ”€â”€ notification_handler.go
â”‚   â”‚       â”œâ”€â”€ stats_handler.go
â”‚   â”‚       â””â”€â”€ audit_handler.go
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/            # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”œâ”€â”€ persistence/           # æŒä¹…åŒ–
â”‚   â”‚   â”‚   â”œâ”€â”€ mysql/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ task_repository.go
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user_repository.go
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ models.go
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ migrations/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ 001_create_tasks.sql
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ 002_create_users.sql
â”‚   â”‚   â”‚   â””â”€â”€ redis/
â”‚   â”‚   â”‚       â”œâ”€â”€ cache.go
â”‚   â”‚   â”‚       â””â”€â”€ session.go
â”‚   â”‚   â”œâ”€â”€ messaging/             # æ¶ˆæ¯ä¼ é€’
â”‚   â”‚   â”‚   â”œâ”€â”€ kafka/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ publisher.go
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ consumer.go
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ config.go
â”‚   â”‚   â”‚   â””â”€â”€ memory/
â”‚   â”‚   â”‚       â””â”€â”€ event_bus.go
â”‚   â”‚   â”œâ”€â”€ external/              # å¤–éƒ¨æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ email/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ smtp_service.go
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ template.go
â”‚   â”‚   â”‚   â””â”€â”€ notification/
â”‚   â”‚   â”‚       â””â”€â”€ webhook_service.go
â”‚   â”‚   â””â”€â”€ config/                # é…ç½®
â”‚   â”‚       â”œâ”€â”€ database.go
â”‚   â”‚       â”œâ”€â”€ kafka.go
â”‚   â”‚       â””â”€â”€ redis.go
â”‚   â”‚
â”‚   â””â”€â”€ interface/                 # æ¥å£é€‚é…å™¨å±‚
â”‚       â”œâ”€â”€ http/                  # HTTP é€‚é…å™¨
â”‚       â”‚   â”œâ”€â”€ controller/
â”‚       â”‚   â”‚   â”œâ”€â”€ task_controller.go
â”‚       â”‚   â”‚   â”œâ”€â”€ user_controller.go
â”‚       â”‚   â”‚   â””â”€â”€ health_controller.go
â”‚       â”‚   â”œâ”€â”€ middleware/
â”‚       â”‚   â”‚   â”œâ”€â”€ auth.go
â”‚       â”‚   â”‚   â”œâ”€â”€ logging.go
â”‚       â”‚   â”‚   â””â”€â”€ cors.go
â”‚       â”‚   â”œâ”€â”€ request/
â”‚       â”‚   â”‚   â”œâ”€â”€ task_request.go
â”‚       â”‚   â”‚   â””â”€â”€ user_request.go
â”‚       â”‚   â”œâ”€â”€ response/
â”‚       â”‚   â”‚   â”œâ”€â”€ task_response.go
â”‚       â”‚   â”‚   â””â”€â”€ common_response.go
â”‚       â”‚   â””â”€â”€ router.go
â”‚       â”œâ”€â”€ grpc/                  # gRPC é€‚é…å™¨
â”‚       â”‚   â”œâ”€â”€ server/
â”‚       â”‚   â”‚   â”œâ”€â”€ task_server.go
â”‚       â”‚   â”‚   â””â”€â”€ user_server.go
â”‚       â”‚   â””â”€â”€ pb/
â”‚       â”‚       â”œâ”€â”€ task.proto
â”‚       â”‚       â”œâ”€â”€ task.pb.go
â”‚       â”‚       â””â”€â”€ task_grpc.pb.go
â”‚       â””â”€â”€ cli/                   # CLI é€‚é…å™¨
â”‚           â”œâ”€â”€ command/
â”‚           â”‚   â”œâ”€â”€ task_cmd.go
â”‚           â”‚   â””â”€â”€ user_cmd.go
â”‚           â””â”€â”€ root.go
â”‚
â”œâ”€â”€ pkg/                           # å…¬å…±åº“ä»£ç 
â”‚   â”œâ”€â”€ logger/                    # æ—¥å¿—åŒ…
â”‚   â”‚   â”œâ”€â”€ logger.go
â”‚   â”‚   â””â”€â”€ zap.go
â”‚   â”œâ”€â”€ validator/                 # éªŒè¯åŒ…
â”‚   â”‚   â””â”€â”€ validator.go
â”‚   â”œâ”€â”€ errors/                    # é”™è¯¯å¤„ç†åŒ…
â”‚   â”‚   â”œâ”€â”€ domain_error.go
â”‚   â”‚   â””â”€â”€ app_error.go
â”‚   â”œâ”€â”€ utils/                     # å·¥å…·åŒ…
â”‚   â”‚   â”œâ”€â”€ time.go
â”‚   â”‚   â”œâ”€â”€ uuid.go
â”‚   â”‚   â””â”€â”€ hash.go
â”‚   â””â”€â”€ constants/                 # å¸¸é‡åŒ…
â”‚       â””â”€â”€ constants.go
â”‚
â”œâ”€â”€ api/                           # API å®šä¹‰
â”‚   â”œâ”€â”€ openapi/                   # OpenAPI è§„èŒƒ
â”‚   â”‚   â””â”€â”€ task-approval.yaml
â”‚   â””â”€â”€ proto/                     # Protocol Buffers å®šä¹‰
â”‚       â”œâ”€â”€ task.proto
â”‚       â””â”€â”€ user.proto
â”‚
â”œâ”€â”€ configs/                       # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.yaml
â”‚   â”œâ”€â”€ config.dev.yaml
â”‚   â”œâ”€â”€ config.prod.yaml
â”‚   â””â”€â”€ docker-compose.yml
â”‚
â”œâ”€â”€ scripts/                       # è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ build.sh
â”‚   â”œâ”€â”€ test.sh
â”‚   â”œâ”€â”€ migrate.sh
â”‚   â””â”€â”€ docker/
â”‚       â”œâ”€â”€ Dockerfile
â”‚       â””â”€â”€ docker-entrypoint.sh
â”‚
â”œâ”€â”€ test/                          # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ integration/               # é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ task_test.go
â”‚   â”‚   â””â”€â”€ user_test.go
â”‚   â”œâ”€â”€ e2e/                      # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â”‚   â””â”€â”€ api_test.go
â”‚   â””â”€â”€ testdata/                 # æµ‹è¯•æ•°æ®
â”‚       â”œâ”€â”€ fixtures/
â”‚       â””â”€â”€ mocks/
â”‚
â”œâ”€â”€ docs/                          # æ–‡æ¡£
â”‚   â”œâ”€â”€ architecture.md
â”‚   â”œâ”€â”€ api.md
â”‚   â””â”€â”€ deployment.md
â”‚
â”œâ”€â”€ deployments/                   # éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ kubernetes/
â”‚   â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”‚   â””â”€â”€ service.yaml
â”‚   â””â”€â”€ helm/
â”‚       â””â”€â”€ task-approval/
â”‚
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .golangci.yml                 # Go lint é…ç½®
â”œâ”€â”€ Makefile
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ README.md
â””â”€â”€ wire.go                       # Wire ä¾èµ–æ³¨å…¥é…ç½®
```

## ğŸ“‹ ç›®å½•ç»“æ„è¯´æ˜

### æ ¸å¿ƒç›®å½•è§£é‡Š

#### `/cmd` - åº”ç”¨ç¨‹åºå…¥å£
- **api/**: Web API æœåŠ¡çš„ä¸»å…¥å£
- **worker/**: äº‹ä»¶å¤„ç†å·¥ä½œè€…è¿›ç¨‹
- **cli/**: å‘½ä»¤è¡Œå·¥å…·

#### `/internal` - ç§æœ‰åº”ç”¨ä»£ç 

**domain/** - é¢†åŸŸå±‚ï¼ˆDDDæ ¸å¿ƒï¼‰
- åŒ…å«æ‰€æœ‰ä¸šåŠ¡é€»è¾‘å’Œé¢†åŸŸæ¨¡å‹
- ä¸ä¾èµ–ä»»ä½•å¤–éƒ¨æ¡†æ¶æˆ–æŠ€æœ¯
- æ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¸å¿ƒ

**application/** - åº”ç”¨æœåŠ¡å±‚
- ç¼–æ’é¢†åŸŸå¯¹è±¡å®Œæˆç”¨ä¾‹
- å¤„ç†äº‹åŠ¡è¾¹ç•Œ
- åè°ƒåŸºç¡€è®¾æ–½æœåŠ¡

**infrastructure/** - åŸºç¡€è®¾æ–½å±‚
- å®ç°é¢†åŸŸå±‚å®šä¹‰çš„æ¥å£
- å¤„ç†æŠ€æœ¯ç»†èŠ‚ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰
- é…ç½®å’Œå¤–éƒ¨æœåŠ¡é›†æˆ

**interface/** - æ¥å£é€‚é…å™¨å±‚
- HTTPã€gRPCã€CLI ç­‰å¤–éƒ¨æ¥å£
- è¯·æ±‚å“åº”çš„åºåˆ—åŒ–/ååºåˆ—åŒ–
- è·¯ç”±å’Œä¸­é—´ä»¶

#### `/pkg` - å…¬å…±åº“
- å¯è¢«å¤–éƒ¨é¡¹ç›®å¼•ç”¨çš„å…¬å…±ä»£ç 
- å·¥å…·å‡½æ•°ã€å¸¸é‡ã€é”™è¯¯ç±»å‹ç­‰

### ä¾èµ–å…³ç³»å›¾

```mermaid
graph TB
    subgraph "cmd"
        API[api/main.go]
        Worker[worker/main.go]
        CLI[cli/main.go]
    end
    
    subgraph "internal"
        Interface[interface/]
        Application[application/]
        Domain[domain/]
        Infrastructure[infrastructure/]
    end
    
    subgraph "pkg"
        Logger[logger/]
        Utils[utils/]
        Errors[errors/]
    end
    
    API --> Interface
    Worker --> Application
    CLI --> Interface
    
    Interface --> Application
    Application --> Domain
    Application --> Infrastructure
    Infrastructure --> Domain
    
    Interface --> pkg
    Application --> pkg
    Infrastructure --> pkg
    Domain --> pkg
```

## ğŸ”§ å…³é”®æ–‡ä»¶ç¤ºä¾‹

### 1. é¢†åŸŸèšåˆæ ¹ (`internal/domain/aggregate/task.go`)
```go
package aggregate

import (
    "time"
    "github.com/task-approval/internal/domain/event"
    "github.com/task-approval/internal/domain/valueobject"
)

// Task ä»»åŠ¡èšåˆæ ¹
type Task struct {
    id          TaskID
    title       string
    description string
    status      valueobject.TaskStatus
    creatorID   UserID
    approverID  UserID
    assigneeID  *UserID
    createdAt   time.Time
    updatedAt   time.Time
    
    // é¢†åŸŸäº‹ä»¶
    events      []event.DomainEvent
    
    // ä¾èµ–çš„æœåŠ¡
    stateMachine TaskStateMachine
}

// Submit æäº¤ä»»åŠ¡
func (t *Task) Submit(user *User) error {
    if err := t.stateMachine.Transition(t, valueobject.TaskStatusPending, user); err != nil {
        return err
    }
    
    t.AddEvent(&event.TaskSubmittedEvent{
        TaskID:    t.id,
        CreatorID: t.creatorID,
        Title:     t.title,
        Timestamp: time.Now(),
    })
    
    return nil
}
```

### 2. åº”ç”¨æœåŠ¡ (`internal/application/service/task_app_service.go`)
```go
package service

import (
    "github.com/task-approval/internal/domain/aggregate"
    "github.com/task-approval/internal/domain/repository"
    "github.com/task-approval/internal/application/command"
    "github.com/task-approval/internal/application/dto"
)

type TaskAppService struct {
    taskRepo      repository.TaskRepository
    userRepo      repository.UserRepository
    eventBus      EventPublisher
    stateMachine  aggregate.TaskStateMachine
}

func (s *TaskAppService) SubmitTask(cmd *command.SubmitTaskCommand) (*dto.TaskDTO, error) {
    // ç”¨ä¾‹é€»è¾‘å®ç°
}
```

### 3. HTTP æ§åˆ¶å™¨ (`internal/interface/http/controller/task_controller.go`)
```go
package controller

import (
    "github.com/gin-gonic/gin"
    "github.com/task-approval/internal/application/service"
    "github.com/task-approval/internal/interface/http/request"
)

type TaskController struct {
    taskAppService *service.TaskAppService
}

func (c *TaskController) SubmitTask(ctx *gin.Context) {
    var req request.SubmitTaskRequest
    if err := ctx.ShouldBindJSON(&req); err != nil {
        ctx.JSON(400, gin.H{"error": err.Error()})
        return
    }
    
    // è½¬æ¢ä¸ºå‘½ä»¤å¯¹è±¡å¹¶è°ƒç”¨åº”ç”¨æœåŠ¡
}
```

### 4. ä»“å‚¨å®ç° (`internal/infrastructure/persistence/mysql/task_repository.go`)
```go
package mysql

import (
    "gorm.io/gorm"
    "github.com/task-approval/internal/domain/aggregate"
    "github.com/task-approval/internal/domain/repository"
)

type taskRepository struct {
    db *gorm.DB
}

func NewTaskRepository(db *gorm.DB) repository.TaskRepository {
    return &taskRepository{db: db}
}

func (r *taskRepository) Save(task *aggregate.Task) error {
    // å®ç°ä¿å­˜é€»è¾‘
}
```

## ğŸ¯ ç›®å½•ç»“æ„çš„ä¼˜åŠ¿

### 1. æ¸…æ™°çš„åˆ†å±‚æ¶æ„
- æ¯ä¸€å±‚éƒ½æœ‰æ˜ç¡®çš„èŒè´£
- ä¾èµ–å…³ç³»å•å‘ï¼Œä¾¿äºç†è§£å’Œç»´æŠ¤

### 2. ç¬¦åˆ DDD åŸåˆ™
- é¢†åŸŸå±‚ç‹¬ç«‹ï¼Œä¸ä¾èµ–å¤–éƒ¨æŠ€æœ¯
- åŸºç¡€è®¾æ–½å±‚å®ç°é¢†åŸŸå±‚å®šä¹‰çš„æ¥å£

### 3. ä¾¿äºæµ‹è¯•
- æ¯å±‚éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•
- æ¥å£æŠ½è±¡ä¾¿äº Mock

### 4. æ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼
- å•ä½“åº”ç”¨ï¼šæ‰€æœ‰ä»£ç åœ¨åŒä¸€è¿›ç¨‹
- å¾®æœåŠ¡ï¼šå¯ä»¥æŒ‰æ¨¡å—æ‹†åˆ†éƒ¨ç½²

### 5. ä»£ç å¤ç”¨
- `/pkg` ç›®å½•çš„å…¬å…±ä»£ç å¯ä»¥è¢«å¤šä¸ªé¡¹ç›®ä½¿ç”¨
- æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œä¾¿äºä»£ç é‡ç”¨

è¿™ä¸ªç›®å½•ç»“æ„ä¸ºä»»åŠ¡å®¡æ‰¹æµé¡¹ç›®æä¾›äº†ï¼š
- **æ¸…æ™°çš„ä»£ç ç»„ç»‡**
- **è‰¯å¥½çš„å¯ç»´æŠ¤æ€§**  
- **ä¾¿äºå›¢é˜Ÿåä½œ**
- **æ”¯æŒé¡¹ç›®æ¼”è¿›**
